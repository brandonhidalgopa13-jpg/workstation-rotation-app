@echo off
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐ SCRIPT DE BUILD PARA RELEASE - REWS v2.2.0
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM Automatiza el proceso completo de testing, calidad y generaciรณn de APK

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ญ REWS - ROTATION AND WORKSTATION SYSTEM - BUILD PARA RELEASE
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

REM Verificar que estamos en el directorio correcto
if not exist "gradlew.bat" (
    echo โ Error: No se encontrรณ gradlew.bat
    echo    Asegรบrate de ejecutar este script desde la raรญz del proyecto
    pause
    exit /b 1
)

echo ๐ Iniciando proceso de build completo...
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐งน LIMPIEZA
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐งน Paso 1/6: Limpiando proyecto...
call gradlew clean
if %ERRORLEVEL% neq 0 (
    echo โ Error en la limpieza del proyecto
    pause
    exit /b 1
)
echo โ Limpieza completada
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐งช TESTS UNITARIOS
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐งช Paso 2/6: Ejecutando tests unitarios...
call gradlew testDebugUnitTest
if %ERRORLEVEL% neq 0 (
    echo โ Error en tests unitarios
    echo ๐ Revisa los reportes en: app\build\reports\tests\testDebugUnitTest\index.html
    pause
    exit /b 1
)
echo โ Tests unitarios completados
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐ ANรLISIS DE CALIDAD
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ Paso 3/6: Ejecutando anรกlisis de calidad (Lint)...
call gradlew lint
if %ERRORLEVEL% neq 0 (
    echo โ๏ธ  Advertencia: Se encontraron issues de lint
    echo ๐ Revisa los reportes en: app\build\reports\lint\lint-results.html
    echo ๐ค ยฟContinuar con el build? (S/N)
    set /p continue=
    if /i not "%continue%"=="S" (
        echo โ Build cancelado por el usuario
        pause
        exit /b 1
    )
)
echo โ Anรกlisis de calidad completado
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐ COBERTURA DE CรDIGO
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ Paso 4/6: Generando reporte de cobertura...
call gradlew jacocoTestReport
if %ERRORLEVEL% neq 0 (
    echo โ๏ธ  Advertencia: Error generando reporte de cobertura
    echo ๐ Revisa los logs para mรกs detalles
)
echo โ Reporte de cobertura generado
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐ง BUILD DEBUG (VERIFICACIรN)
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ง Paso 5/6: Verificando build debug...
call gradlew assembleDebug
if %ERRORLEVEL% neq 0 (
    echo โ Error en build debug
    pause
    exit /b 1
)
echo โ Build debug verificado
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐ BUILD RELEASE
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ Paso 6/6: Generando APK de release...

REM Verificar si existe keystore.properties
if not exist "keystore.properties" (
    echo โ๏ธ  Advertencia: No se encontrรณ keystore.properties
    echo    Se usarรก keystore de debug para firmar la APK
    echo    Para producciรณn, configura keystore.properties siguiendo keystore.properties.example
    echo.
)

call gradlew assembleRelease
if %ERRORLEVEL% neq 0 (
    echo โ Error en build release
    echo ๐ก Posibles causas:
    echo    - Problemas con keystore.properties
    echo    - Errores de ProGuard
    echo    - Dependencias faltantes
    pause
    exit /b 1
)

echo โ APK de release generada exitosamente
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM ๐ RESUMEN FINAL
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo ๐ BUILD COMPLETADO EXITOSAMENTE
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.
echo ๐ฑ APK de release generada en:
echo    app\build\outputs\apk\release\app-release.apk
echo.
echo ๐ Reportes disponibles:
echo    ๐งช Tests: app\build\reports\tests\testDebugUnitTest\index.html
echo    ๐ Lint: app\build\reports\lint\lint-results.html
echo    ๐ Cobertura: app\build\reports\jacoco\jacocoTestReport\html\index.html
echo.
echo ๐ Informaciรณn de la APK:
for %%f in (app\build\outputs\apk\release\app-release.apk) do echo    ๐ฆ Tamaรฑo: %%~zf bytes

REM Mostrar informaciรณn adicional si existe
if exist "app\build\outputs\apk\release\app-release.apk" (
    echo    ๐ Generada: %date% %time%
    echo    ๐ท๏ธ  Versiรณn: 2.2.0
    echo    ๐ฏ Target SDK: 34
    echo    ๐ฑ Min SDK: 24
)

echo.
echo ๐ ยกLa APK estรก lista para distribuciรณn!
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
pause